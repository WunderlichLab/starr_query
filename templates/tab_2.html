{% if enhancers %}
    {% for e in enhancers %}
        {% if loop.first %}
        <!-- Gene Info (shown once) -->
        <table id="geneInfo">
          <tbody>
          <tr>
              <td rowspan="3"><strong>Gene Information</strong></td>
              <td></td>
              <td></td>
          </tr>
            <tr>
              <td><strong>Gene Symbol</strong></td>
              <td>{{ e.gene_symbol }}</td>
            </tr>
            <tr>
              <td><strong>Gene ID</strong></td>
              <td>{{ e.gene_id }}</td>
            </tr>
          <tr>
              <td rowspan="4"><strong>TPM Values</strong></td>
              <td></td>
              <td></td>
          </tr>
            <tr>
              <td><strong>Control</strong></td>
              <td>{{ e.tpm_ctrl }}</td>
            </tr>
            <tr>
              <td><strong>IMD</strong></td>
              <td>{{ e.tpm_imd }}</td>
            </tr>
            <tr>
              <td><strong>20E</strong></td>
              <td>{{ e.tpm_20e }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Enhancer Table -->
        <table id="enhancerTable" class="display" style="width:100%; margin-top:1em;">
          <thead>
            <tr>
                <th>Enhancer Name</th>
                <th>Enhancer Length</th>
                <th>Accessibility</th>
                <th>Activity Score</th>
                <th>Condition</th>
            </tr>
          </thead>
          <tbody>
        {% endif %}

            <!-- Enhancer Row -->
            <tr>
                <td>
                    {% if e.chromosome and e.start and e.end %}
                        <a href="https://genome.ucsc.edu/cgi-bin/hgTracks?db=dm6&position={{ e.chromosome }}:{{ e.start }}-{{ e.end }}" target="_blank">
                            {{ e.enhancer_id }}
                        </a>
                    {% else %}
                        {{ e.enhancer_id or 'N/A' }}
                    {% endif %}
                </td>
                <td>{{ e.en_length }}</td>
                <td>{{ e.accessibility or '-' }}</td>
                <td>{{ e.act_score or ('-' if e.act_score == 0) }}</td>
                <td>{{ e.exp_condition }}</td>
            </tr>

        {% if loop.last %}
          </tbody>
        </table>
        {% endif %}
    {% endfor %}

{% elif error_message %}
    <p>{{ error_message }}</p>
{% else %}
    <p>No enhancers found matching your criteria.</p>
{% endif %}
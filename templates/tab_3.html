{% if error_message %}
    <div style="color: #d32f2f; background-color: #ffebee; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
        {{ error_message }}
    </div>
{% endif %}

{% if enhancers %}
    <div style="margin-bottom: 1em;">
        <strong>Total Results Found: {{ enhancers|length }}</strong>
    </div>

    <!-- Enhancer Table -->
    <table id="activityClassTable" class="display" style="width:100%;">
        <thead>
        <tr>
            <th>Enhancer Name</th>
            <th>Activity Class</th>
            <th>Accessibility</th>
            <th>Gene ID</th>
            <th>Distance to Enhancer</th>
            <th>Time Cluster</th>
            <th>Broad Immune Role</th>
        </tr>
        </thead>
        <tbody>
        {% for e in enhancers %}
            <tr>
                <td>{{ e.enhancer_name or '-' }}</td>
                <td>{{ e.activity_class or '-' }}</td>
                <td>{{ e.accessibility or '-'}}</td>
                <td>{{ e.gene_id or '-' }}</td>
                <td>{{ e.dist_to_enh if e.dist_to_enh is not none else '-' }}</td>
                <td>{{ e.time_cluster or '-' }}</td>
                <td>{{ e.broad_immune_role or '-' }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Visualization Controls at the bottom -->
    <div class="chart-container" style="margin-top: 2rem;">
        <h4>Data Visualization</h4>
        <div style="background: #f5f5f5; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <label>
                    Chart Type:
                    <select id="chart_type">
                        <option value="bar">Bar Chart</option>
                        <option value="pie">Pie Chart</option>
                    </select>
                </label>
                <label>
                    Group By:
                    <select id="x_axis">
                        <option value="activity_class">Activity Class</option>
                        <option value="accessibility">Accessibility</option>
                        <option value="time_cluster">Time Cluster</option>
                        <option value="broad_immune_role">Broad Immune Role</option>
                    </select>
                </label>
                <button onclick="updateTab3Chart()" style="align-self: end; padding: 0.6rem 1.5rem; background-color: #2c5aa0; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                    Update Chart
                </button>
            </div>
        </div>
        <div id="tab3_chart" style="width: 100%; height: 500px;"></div>
    </div>

    <!-- Store data for charts -->
    <script id="tab3-data" type="application/json">
    {{ enhancers | tojson }}
    </script>

{% elif not error_message %}
    <p>No enhancers found matching your criteria.</p>
{% endif %}